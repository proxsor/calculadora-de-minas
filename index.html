<html>
    <head></head>
    <body>
        <form id="form-calculate" onsubmit="event.returnValue=false; return false;">
            Posici√≥n del planeta (del 1 al 15): <input type="number" id="position" min="1" max="15" onchange="calculate();"></input> <br/>
            Nivel de mina de metal: <input type="number" id="metal-level" min="1" max="200" onchange="calculate();"></input> <br/>
            Nivel de mina de cristal: <input type="number" id="crystal-level" min="1" max="200" onchange="calculate();"></input> <br/>
            Nivel de sintetizador de deuterio: <input type="number" id="deuterium-level" min="1" max="200" onchange="calculate();"></input> <br/>
            <button id="bt-calculate">Calcular</button>
            <div id="div-result"></div>
        </form>
        <script>

            const METAL_TYPE = 'metal';
            const CRYSTAL_TYPE = 'crystal';
            const DEUTERIUM_TYPE = 'deuterium';

            const productionMultiplierByMineType = {
                [METAL_TYPE]: 30,
                [CRYSTAL_TYPE]: 20,
                [DEUTERIUM_TYPE]: 10,
            };

            const productionBonusesByPlanetSlot = {
                1: {
                    [METAL_TYPE]: 0,
                    [CRYSTAL_TYPE]: 0.34,
                    [DEUTERIUM_TYPE]: 0,
                },
                2: {
                    [METAL_TYPE]: 0,
                    [CRYSTAL_TYPE]: 0.32,
                    [DEUTERIUM_TYPE]: 0,
                },
                3: {
                    [METAL_TYPE]: 0,
                    [CRYSTAL_TYPE]: 0.30,
                    [DEUTERIUM_TYPE]: 0,
                },
                4: {
                    [METAL_TYPE]: 0.15,
                    [CRYSTAL_TYPE]: 0.15,
                    [DEUTERIUM_TYPE]: 0,
                },
                5: {
                    [METAL_TYPE]: 0.15,
                    [CRYSTAL_TYPE]: 0.15,
                    [DEUTERIUM_TYPE]: 0,
                },
                6: {
                    [METAL_TYPE]: 0.15,
                    [CRYSTAL_TYPE]: 0.15,
                    [DEUTERIUM_TYPE]: 0,
                },
                7: {
                    [METAL_TYPE]: 0.3,
                    [CRYSTAL_TYPE]: 0,
                    [DEUTERIUM_TYPE]: 0,
                },
                8: {
                    [METAL_TYPE]: 0.3,
                    [CRYSTAL_TYPE]: 0,
                    [DEUTERIUM_TYPE]: 0,
                },
                9: {
                    [METAL_TYPE]: 0.3,
                    [CRYSTAL_TYPE]: 0,
                    [DEUTERIUM_TYPE]: 0,
                },
                10: {
                    [METAL_TYPE]: 0.1,
                    [CRYSTAL_TYPE]: 0,
                    [DEUTERIUM_TYPE]: 0.15,
                },
                11: {
                    [METAL_TYPE]: 0.1,
                    [CRYSTAL_TYPE]: 0,
                    [DEUTERIUM_TYPE]: 0.15,
                },
                12: {
                    [METAL_TYPE]: 0.1,
                    [CRYSTAL_TYPE]: 0,
                    [DEUTERIUM_TYPE]: 0.15,
                },
                13: {
                    [METAL_TYPE]: 0,
                    [CRYSTAL_TYPE]: 0,
                    [DEUTERIUM_TYPE]: 0.2,
                },
                14: {
                    [METAL_TYPE]: 0,
                    [CRYSTAL_TYPE]: 0,
                    [DEUTERIUM_TYPE]: 0.2,
                },
                15: {
                    [METAL_TYPE]: 0,
                    [CRYSTAL_TYPE]: 0,
                    [DEUTERIUM_TYPE]: 0.2,
                },
            }

            const temperatureByPlanetSlot = {
                1: 85,
                2: 80,
                3: 75,
                4: 70,
                5: 60,
                6: 50,
                7: 40,
                8: 30,
                9: 20,
                10: 10,
                11: 0,
                12: -10,
                13: -20,
                14: -30,
                15: -40,
            };

            const getBaseMineProduction = (mineType, level, planetSlotNumber, universeMultiplier, minimumTemperature, maximumTemperature) => {
                let baseProduction = productionMultiplierByMineType[mineType] * universeMultiplier * level * Math.pow(1.1, level) * (1 + productionBonusesByPlanetSlot[planetSlotNumber][mineType]);
                const minimumLevelForExtraProductionBoost = mineType === DEUTERIUM_TYPE ? 46 : 50;
                if (level > minimumLevelForExtraProductionBoost) {
                    baseProduction *= Math.pow(1.05, (level - minimumLevelForExtraProductionBoost));
                }
                if (level > 120) {
                    baseProduction /= Math.pow(1.05, (level - 120));
                }
                if (mineType === DEUTERIUM_TYPE) {
                    baseProduction *= 1.2 - 0.004 * (maximumTemperature + minimumTemperature) / 2;
                }
                return Math.round(baseProduction);
            }

            const getMineCost = (mineType, level) => {
                if (mineType === METAL_TYPE) {
                    if (level <= 20) {
                        return {
                            metal: parseInt(80 * Math.pow(1.48, level - 1)),
                            crystal: parseInt(20 * Math.pow(1.48, level - 1))
                        };
                    }
                    else if (level <= 30) {
                        return {
                            metal: parseInt(137424 * Math.pow(1.46, level - 20)),
                            crystal: parseInt(34356 * Math.pow(1.46, level - 20))
                        };
                    }
                    else if (level <= 40) {
                        return {
                            metal: parseInt(6047713 * Math.pow(1.445, level - 30)),
                            crystal: parseInt(1511928 * Math.pow(1.445, level - 30))
                        };
                    }
                    else if (level <= 50) {
                        return {
                            metal: parseInt(240032257 * Math.pow(1.43, level - 40)),
                            crystal: parseInt(60008064 * Math.pow(1.43, level - 40))
                        };
                    }
                    else if (level <= 60) {
                        return {
                            metal: parseInt(8582819573 * Math.pow(1.41, level - 50)),
                            crystal: parseInt(2145704893 * Math.pow(1.41, level - 50))
                        };
                    }
                    else if (level <= 65) {
                        return {
                            metal: parseInt(266576038331 * Math.pow(1.39, level - 60)),
                            crystal: parseInt(66644009575 * Math.pow(1.39, level - 60))
                        };
                    }
                    else if (level <= 70) {
                        return {
                            metal: parseInt(1383232265343 * Math.pow(1.37, level - 65)),
                            crystal: parseInt(345808066295 * Math.pow(1.37, level - 65))
                        };
                    }
                    else if (level <= 75) {
                        return {
                            metal: parseInt(6675717445001 * Math.pow(1.35, level - 70)),
                            crystal: parseInt(1668929361053 * Math.pow(1.35, level - 70))
                        };
                    }
                    else if (level <= 80) {
                        return {
                            metal: parseInt(29934140242686 * Math.pow(1.33, level - 75)),
                            crystal: parseInt(7483535059787 * Math.pow(1.33, level - 75))
                        };
                    }
                    else if (level <= 85) {
                        return {
                            metal: parseInt(124573307057205 * Math.pow(1.31, level - 80)),
                            crystal: parseInt(31143326760620 * Math.pow(1.31, level - 80))
                        };
                    }
                    else if (level <= 90) {
                        return {
                            metal: parseInt(480597461040428 * Math.pow(1.29, level - 85)),
                            crystal: parseInt(120149365245905 * Math.pow(1.29, level - 85))
                        };
                    }
                    else if (level <= 95) {
                        return {
                            metal: parseInt(1716840792312547 * Math.pow(1.27, level - 90)),
                            crystal: parseInt(429210198027402 * Math.pow(1.27, level - 90))
                        };
                    }
                    else if (level <= 100) {
                        return {
                            metal: parseInt(5672162030942849 * Math.pow(1.25, level - 95)),
                            crystal: parseInt(1418040507568092 * Math.pow(1.25, level - 95))
                        };
                    }
                    else if (level <= 105) {
                        return {
                            metal: parseInt(17310064791695706 * Math.pow(1.23, level - 100)),
                            crystal: parseInt(4327516197412390 * Math.pow(1.23, level - 100))
                        };
                    }
                    else if (level <= 110) {
                        return {
                            metal: parseInt(48733123803662216 * Math.pow(1.21, level - 105)),
                            crystal: parseInt(12183280949475422 * Math.pow(1.21, level - 105))
                        };
                    }
                    else if (level <= 115) {
                        return {
                            metal: parseInt(126401172422868705 * Math.pow(1.19, level - 110)),
                            crystal: parseInt(31600293101981844 * Math.pow(1.19, level - 110))
                        };
                    }
                    else if (level <= 120) {
                        return {
                            metal: parseInt(301637900426963684 * Math.pow(1.17, level - 115)),
                            crystal: parseInt(75409475097827097 * Math.pow(1.17, level - 115))
                        };
                    }
                    else {
                        return {
                            metal: parseInt(661325422283768720 * Math.pow(1.15, level - 120)),
                            crystal: parseInt(165331355551399084 * Math.pow(1.15, level - 120))
                        };
                    }
                }
                if (mineType === CRYSTAL_TYPE) {
                    if (level <= 20) {
                        return {
                            metal: parseInt(64 * Math.pow(1.48, level - 1)),
                            crystal: parseInt(32 * Math.pow(1.48, level - 1))
                        };
                    }
                    else if (level <= 30) {
                        return {
                            metal: parseInt(109939 * Math.pow(1.46, level - 20)),
                            crystal: parseInt(54970 * Math.pow(1.46, level - 20))
                        };
                    }
                    else if (level <= 40) {
                        return {
                            metal: parseInt(4838170 * Math.pow(1.445, level - 30)),
                            crystal: parseInt(2419085 * Math.pow(1.445, level - 30))
                        };
                    }
                    else if (level <= 50) {
                        return {
                            metal: parseInt(192025805 * Math.pow(1.43, level - 40)),
                            crystal: parseInt(96012903 * Math.pow(1.43, level - 40))
                        };
                    }
                    else if (level <= 60) {
                        return {
                            metal: parseInt(6866255658 * Math.pow(1.41, level - 50)),
                            crystal: parseInt(3433127829 * Math.pow(1.41, level - 50))
                        };
                    }
                    else if (level <= 65) {
                        return {
                            metal: parseInt(213260830652 * Math.pow(1.39, level - 60)),
                            crystal: parseInt(106630415326 * Math.pow(1.39, level - 60))
                        };
                    }
                    else if (level <= 70) {
                        return {
                            metal: parseInt(1106585812208 * Math.pow(1.37, level - 65)),
                            crystal: parseInt(553292906104 * Math.pow(1.37, level - 65))
                        };
                    }
                    else if (level <= 75) {
                        return {
                            metal: parseInt(5340573955680 * Math.pow(1.35, level - 70)),
                            crystal: parseInt(2670286977840 * Math.pow(1.35, level - 70))
                        };
                    }
                    else if (level <= 80) {
                        return {
                            metal: parseInt(23947312192710 * Math.pow(1.33, level - 75)),
                            crystal: parseInt(11973656096355 * Math.pow(1.33, level - 75))
                        };
                    }
                    else if (level <= 85) {
                        return {
                            metal: parseInt(99658645639776 * Math.pow(1.31, level - 80)),
                            crystal: parseInt(49829322819888 * Math.pow(1.31, level - 80))
                        };
                    }
                    else if (level <= 90) {
                        return {
                            metal: parseInt(384477968809241 * Math.pow(1.29, level - 85)),
                            crystal: parseInt(192238984404620 * Math.pow(1.29, level - 85))
                        };
                    }
                    else if (level <= 95) {
                        return {
                            metal: parseInt(1373472633767512 * Math.pow(1.27, level - 90)),
                            crystal: parseInt(686736316883754 * Math.pow(1.27, level - 90))
                        };
                    }
                    else if (level <= 100) {
                        return {
                            metal: parseInt(4537729624481628 * Math.pow(1.25, level - 95)),
                            crystal: parseInt(2268864812240807 * Math.pow(1.25, level - 95))
                        };
                    }
                    else if (level <= 105) {
                        return {
                            metal: parseInt(13848051832524499 * Math.pow(1.23, level - 100)),
                            crystal: parseInt(6924025916262228 * Math.pow(1.23, level - 100))
                        };
                    }
                    else if (level <= 110) {
                        return {
                            metal: parseInt(38986499040587253 * Math.pow(1.21, level - 105)),
                            crystal: parseInt(19493249520293566 * Math.pow(1.21, level - 105))
                        };
                    }
                    else if (level <= 115) {
                        return {
                            metal: parseInt(101120937932219071 * Math.pow(1.19, level - 110)),
                            crystal: parseInt(50560468966109378 * Math.pow(1.19, level - 110))
                        };
                    }
                    else if (level <= 120) {
                        return {
                            metal: parseInt(241310320327071718 * Math.pow(1.17, level - 115)),
                            crystal: parseInt(120655160163535483 * Math.pow(1.17, level - 115))
                        };
                    }
                    else {
                        return {
                            metal: parseInt(529060337795226169 * Math.pow(1.15, level - 120)),
                            crystal: parseInt(264530168897612260 * Math.pow(1.15, level - 120))
                        };
                    }
                }
                if (mineType === DEUTERIUM_TYPE) {
                    if (level <= 20) {
                        return {
                            metal: parseInt(340 * Math.pow(1.48, level - 1))
                            , crystal: parseInt(100 * Math.pow(1.48, level - 1))
                        };
                    }
                    else if (level <= 30) {
                        return {
                            metal: parseInt(584052 * Math.pow(1.46, level - 20)),
                            crystal: parseInt(171780 * Math.pow(1.46, level - 20))
                        };
                    }
                    else if (level <= 40) {
                        return {
                            metal: parseInt(25702778 * Math.pow(1.445, level - 30)),
                            crystal: parseInt(7559641 * Math.pow(1.445, level - 30))
                        };
                    }
                    else if (level <= 50) {
                        return {
                            metal: parseInt(1020137091 * Math.pow(1.43, level - 40)),
                            crystal: parseInt(300040321 * Math.pow(1.43, level - 40))
                        };
                    }
                    else if (level <= 60) {
                        return {
                            metal: parseInt(36476983184 * Math.pow(1.41, level - 50)),
                            crystal: parseInt(10728524466 * Math.pow(1.41, level - 50))
                        };
                    }
                    else if (level <= 65) {
                        return {
                            metal: parseInt(1132948162869 * Math.pow(1.39, level - 60)),
                            crystal: parseInt(333220047906 * Math.pow(1.39, level - 60))
                        };
                    }
                    else if (level <= 70) {
                        return {
                            metal: parseInt(5878737127512 * Math.pow(1.37, level - 65)),
                            crystal: parseInt(1729040331638 * Math.pow(1.37, level - 65))
                        };
                    }
                    else if (level <= 75) {
                        return {
                            metal: parseInt(28371799140311 * Math.pow(1.35, level - 70)),
                            crystal: parseInt(8344646806055 * Math.pow(1.35, level - 70))
                        };
                    }
                    else if (level <= 80) {
                        return {
                            metal: parseInt(127220096027188 * Math.pow(1.33, level - 75)),
                            crystal: parseInt(37417675302478 * Math.pow(1.33, level - 75))
                        };
                    }
                    else if (level <= 85) {
                        return {
                            metal: parseInt(529436554975531 * Math.pow(1.31, level - 80)),
                            crystal: parseInt(155716633817847 * Math.pow(1.31, level - 80))
                        };
                    }
                    else if (level <= 90) {
                        return {
                            metal: parseInt(2042539209353959 * Math.pow(1.29, level - 85)),
                            crystal: parseInt(600746826286418 * Math.pow(1.29, level - 85))
                        };
                    }
                    else if (level <= 95) {
                        return {
                            metal: parseInt(7296573367085910 * Math.pow(1.27, level - 90)),
                            crystal: parseInt(2146050990340254 * Math.pow(1.27, level - 90))
                        };
                    }
                    else if (level <= 100) {
                        return {
                            metal: parseInt(24106688630706210 * Math.pow(1.25, level - 95)),
                            crystal: parseInt(7090202538511950 * Math.pow(1.25, level - 95))
                        };
                    }
                    else if (level <= 105) {
                        return {
                            metal: parseInt(73567775362262603 * Math.pow(1.23, level - 100)),
                            crystal: parseInt(21637580989111175 * Math.pow(1.23, level - 100))
                        };
                    }
                    else if (level <= 110) {
                        return {
                            metal: parseInt(207115776158683397 * Math.pow(1.21, level - 105)),
                            crystal: parseInt(60916404753146307 * Math.pow(1.21, level - 105))
                        };
                    }
                    else if (level <= 115) {
                        return {
                            metal: parseInt(537204982779344402 * Math.pow(1.19, level - 110)),
                            crystal: parseInt(158001465524873035 * Math.pow(1.19, level - 110))
                        };
                    }
                    else if (level <= 120) {
                        return {
                            metal: parseInt(1281961076772004987 * Math.pow(1.17, level - 115)),
                            crystal: parseInt(377047375524844441 * Math.pow(1.17, level - 115))
                        };
                    }
                    else {
                        return {
                            metal: parseInt(2810633044612639230 * Math.pow(1.15, level - 120)),
                            crystal: parseInt(826656777835285451 * Math.pow(1.15, level - 120))
                        };
                    }
                }
            };

            function calculate() {
                if (!document.querySelector('form').reportValidity()) return false;
                const position = parseInt(document.getElementById('position').value);
                const metalLevel = parseInt(document.getElementById('metal-level').value);
                const crystalLevel = parseInt(document.getElementById('crystal-level').value);
                const deuteriumLevel = parseInt(document.getElementById('deuterium-level').value);
                if (isNaN(position) || isNaN(metalLevel) || isNaN(crystalLevel) || isNaN(deuteriumLevel)) return false;
                const temperature = temperatureByPlanetSlot[position];
                const metalProduction = getBaseMineProduction(METAL_TYPE, metalLevel, position, 1000, temperature, temperature);
                const crystalProduction = getBaseMineProduction(CRYSTAL_TYPE, crystalLevel, position, 1000, temperature, temperature);
                const deuteriumProduction = getBaseMineProduction(DEUTERIUM_TYPE, deuteriumLevel, position, 1000, temperature, temperature);
                const metalCost = getMineCost(METAL_TYPE, metalLevel);
                const crystalCost = getMineCost(CRYSTAL_TYPE, crystalLevel);
                const deuteriumCost = getMineCost(DEUTERIUM_TYPE, deuteriumLevel);
                const metalAmortization = (metalCost.metal + metalCost.crystal * 1.5) / (metalProduction);
                const crystalAmortization = (crystalCost.metal + crystalCost.crystal * 1.5) / (crystalProduction * 1.5);
                const deuteriumAmortization = (deuteriumCost.metal + deuteriumCost.crystal * 1.5) / (deuteriumProduction * 3);
                console.log({metalAmortization, crystalAmortization, deuteriumAmortization});
                const minimumAmortization = Math.min(metalAmortization, crystalAmortization, deuteriumAmortization);
                if (metalAmortization === minimumAmortization) {
                    document.getElementById('div-result').innerText = "Sub√≠ el metal!";
                }
                if (crystalAmortization === minimumAmortization) {
                    document.getElementById('div-result').innerText = "Sub√≠ el cristal!";
                }
                if (deuteriumAmortization === minimumAmortization) {
                    document.getElementById('div-result').innerText = "Sub√≠ el deuterio!";
                }
                return false;
            }

            const btCalculate = document.getElementById("bt-calculate");
            btCalculate.addEventListener('click', calculate);
            const form = document.getElementById('form-calculate');
            //form.addEventListener('submit', calculate); 
            
        </script>
    </body>
</html>